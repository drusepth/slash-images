<?php	session_start();		require_once("settings.php");	$content = 0;?><html><head>	<title><?php echo $cf['title']; ?></title>	<link rel="stylesheet" href="css.php.css" type="text/css" /> </head><body>	<?php		if (strpos($_GET['folder'], '..') > -1) {			die;		}		#$directories_queue = 0;		$directories = array();		$stats['files_found'] = 0;		$stats['folders_found'] = 0;				$core_directory = $cf['thumbs_directory'] . '/';		$link_directory = $cf['content_directory'] . '/';				debug("Scanning directory [$core_directory]<br />\n<blockquote>");				if ($handle = opendir($core_directory)) {			while (false !== ($file = readdir($handle))) {				if ($file == '.' or $file == '..') {					continue;				}				if (is_dir($core_directory . $file)) {					debug("Found directory: [$core_directory$file]<br />\n");					array_push($directories, "$core_directory$file");					$stats['folders_found']++;					#$directories[$directories_queue++] = "$core_directory$file";				} else {					debug("Found file: [$file]<br />\n");					$stats['files_found']++;				}			}			closedir($handle);		}				debug('</blockquote>');		debug('<hr />');		debug('Folders found in the root directory (' . $core_directory . '):<br /><blockquote><strong>$directories</strong> = ');		debug($directories);		#print_r($directories);		debug('</blockquote><hr /><em>Recursing back into found folders to find more.</em><br /><br />');				#for ($i = 0; $i < $directories_queue; $i++) {		$directories_copy = $directories;		while ($cur_dir = array_pop($directories)) {			#debug('Scanning directory [' . $directories[$i] . ']<br />' . "\n" . '<blockquote>');			debug('Scanning directory [' . $cur_dir . ']<br />' . "\n" . '<blockquote>');						#if ($handle = opendir($directories[$i])) {			if ($handle = opendir($cur_dir)) {				while (false !== ($file = readdir($handle))) {					if ($file == '.' or $file == '..') {						continue;					}					if (is_dir($directories[$i] . '/' . $file)) {						#debug("Found directory: [" . $directories[$i] . "/$file/]<br />\n");						debug("Found directory: [" . $cur_dir . "/$file/]<br />\n");						array_push($directories, $cur_dir . "/$file/");						#$directories[$directories_queue++] = $directories[$i] . "/$file/";						$stats['folders_found']++;					} else {						debug("Found file: [$file]<br />\n");						$stats['files_found']++;					}				}				closedir($handle);			}						debug('</blockquote>');		}		$directories = $directories_copy;			?>	<div id="menu">		<strong>Images:</strong> 		<?php			echo "\n";			for ($i = 0; $i < count($directories); $i++)			{				$extract = substr($directories[$i], strrpos($directories[$i], "/") + 1);				if ($i == 0)				{					echo "<span class='featured'><a href='?folder=$extract'>$extract</a></span>\n";				}				else				{					echo "<a href='?folder=$extract'>$extract</a>\n";				}			}		?>				<div class="control_box">			<a href="index.php">Home</a>			<a href="index.php?stats">Stats</a>			<a href="index.php?admin">Administrate</a>		</div>	</div>		<div id="content">		<?php			$directory = '';			if (isset($_GET['folder'])) {				$content = 1;				if (is_dir($core_directory . $_GET['folder'])) {					$directory = $core_directory . $_GET['folder'];				}			}								if ($handle = opendir($directory)) {				while (false !== ($file = readdir($handle))) {					if ($file == '.' or $file == '..') {						continue;					}					if (!is_dir($directory . '/' . $file)) {						$srcdir = str_replace($cf['thumbs_directory'], $cf['content_directory'], $directory);						$srcfile = str_replace("thumb_", "", $file);						echo "<a href='$srcdir/$srcfile'><img src='$directory/$file'></a>\n";					}				}				closedir($handle);			}		?>				<?php			if (isset($_GET['stats'])) {				$content = 1;		?>						<div class="box">					<div class="box_title"><?php echo $cf['title'];?> Image Stats</div>					<ul>						<li>There are <strong><?php echo $stats['files_found']; ?></strong> pictures in 						<strong><?php echo $stats['folders_found']; ?></strong> folders.</li>						<li>That's an average of <strong><?php echo ($stats['files_found'] / $stats['folders_found']); ?></strong>						pictures per folder.</li>						<li>The <strong>favored category</strong> for most users is <a href="?folder=Black">Black</a>.</li>					</ul>				</div>												<div class="box">					<div class="box_title"><?php echo $cf['title'];?> Site Stats</div>					<ul>						<li>Since <strong>February 12, 2009</strong>, the main page has been accessed <strong>5326</strong> times.</li>						<li>Thumbnails that have been clicked to view their full image: <strong>35452</strong>.</li>					</ul>				</div>								<div class="box">					<div class="box_title"><?php echo $cf['title']; ?> User Stats</div>					<ul>						<li>The majority of visitors come from <strong>America</strong>.</li>						<li>The majority of visitors are <strong>English</strong>-speaking.</li>					</ul>				</div>					<?php			}		?>				<?php			if (isset($_GET['admin'])) {				$content = 1;		?>			<div class="box">				<div class="box_title"><?php echo $cf['title']; ?> Control Panel</div>				<strong>Access Error</strong>: You are not <a href="#">authenticated</a> as an administrator, and therefore do not have 				permission to view this page.			</div>		<?php			}		?>				<?php			if ($content == 0) {		?>		    <div class="box">		    	<div class="control_box">1:24 AM <strong>January 18, 2011</strong></div>		    	<div class="box_title">Welcome to <?php echo $cf['title']; ?>!</div>		    	Here you'll find a wide variety of wallpapers for your computer. They're arranged by color at the top there,		    	you see? There's also a <em>featured</em> wallpaper page that occasionally changes to feature neat, new 		    	stuff. Enjoy yourself!		    </div>					<div class="box">				<div class="control_box">2:08 AM <strong>January 10, 2011</strong></div>				<div class="box_title"><?php echo $cf['title']; ?> Home & Introducing Drims</div>				Welcome to <?php echo $cf['title']; ?> - an image site using the <strong>Drims CMS</strong>.  The purpose of the site				is to share images, intelligently and freely through the use of the powerful software, <strong>Drims</strong>.				<blockquote>					Drims CMS is a full-fletched image gallery suite for everyone.  Whether you're a photographer that wants to show off					your photos by high-resolution albums and galleries, or you're a collector of online images - such as comics or fan art - 					or even if you're just a teenage girl that wants to share a boatload of pictures of yourself, Drims has something for you.  					For more information, stay tuned. We'll have a GitHub repo soon!				</blockquote>			</div>		<?php			}		?>		</div>	</body></html>